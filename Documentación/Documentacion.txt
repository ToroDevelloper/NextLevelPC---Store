=================================================================
NEXTLEVEL PC - DOCUMENTACIÓN DE CAMBIOS Y MEJORAS
=================================================================

PENDIENTES:
- Login: mostrar nombre del usuario al logiarse y apartado de perfil
- Productos: organización más dinámica con carruseles horizontales
- Footer: iconos reales de redes sociales (Facebook, Instagram)
- Admin: interfaz para subir productos desde el dashboard

=================================================================
IMPLEMENTACIONES COMPLETADAS
=================================================================

-------------------------------------------------------------------
NOVIEMBRE 14-15, 2025 - SISTEMA BASE
-------------------------------------------------------------------

✓ Detalle de Servicios con página individual
✓ Campo imagen_url en tabla servicios
✓ Carrito de compras con persistencia (localStorage)
✓ Agendamiento de citas para servicios
✓ Sistema de roles (cliente, empleado, admin)
✓ Perfil básico en SPA
✓ Tabla refresh_tokens para autenticación

SCRIPTS SQL APLICADOS:

-- Agregar imagen_url a servicios (si no existe)
ALTER TABLE `servicios`
  ADD COLUMN `imagen_url` varchar(255) DEFAULT NULL AFTER `descripcion`;

-- Tabla citas_servicios
CREATE TABLE IF NOT EXISTS `citas_servicios` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `servicio_id` INT(11) NOT NULL,
  `nombre_cliente` VARCHAR(255) NOT NULL,
  `email_cliente` VARCHAR(255) NOT NULL,
  `telefono_cliente` VARCHAR(50) NOT NULL,
  `direccion_cliente` TEXT NOT NULL,
  `fecha_cita` DATETIME NOT NULL,
  `descripcion_problema` TEXT DEFAULT NULL,
  `estado` ENUM('pendiente', 'confirmada', 'cancelada', 'completada') NOT NULL DEFAULT 'pendiente',
  `created_at` TIMESTAMP NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  KEY `servicio_id` (`servicio_id`),
  CONSTRAINT `citas_servicios_ibfk_1` FOREIGN KEY (`servicio_id`) REFERENCES `servicios` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- Tabla refresh_tokens
CREATE TABLE `refresh_tokens` (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    token VARCHAR(512) NOT NULL UNIQUE,
    expires_at DATETIME NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES usuarios(id) ON DELETE CASCADE,
    INDEX idx_user_id (user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- Descripción detallada en productos
ALTER TABLE `productos`
  ADD COLUMN `descripcion_corta` VARCHAR(300) NULL AFTER `nombre`,
  ADD COLUMN `descripcion_detallada` TEXT NULL AFTER `descripcion_corta`,
  ADD COLUMN `especificaciones` TEXT NULL AFTER `descripcion_detallada`;

-------------------------------------------------------------------
NOVIEMBRE 16, 2025 - MEJORAS PRODUCTOS Y FILTROS
-------------------------------------------------------------------

✓ Filtrado por categorías en productos
✓ Estado visual de productos (activo/inactivo)
✓ Mejoras en normalización de imágenes
✓ Optimización de rendimiento con memoización
✓ Custom hooks para separación de responsabilidades

SCRIPTS SQL APLICADOS:

-- Modificar columna activo a estado
ALTER TABLE productos DROP COLUMN activo;
ALTER TABLE productos ADD COLUMN estado TINYINT(1) NOT NULL DEFAULT 1;

-------------------------------------------------------------------
NOVIEMBRE 20, 2025 - GALERÍA DE IMÁGENES Y UX SERVICIOS
-------------------------------------------------------------------

✓ Sistema de galería con tabla relacional (servicio_imagenes)
✓ Redesign página detalle servicios (inspirado en Mercado Libre)
✓ Breadcrumbs de navegación
✓ Trust Badges (4 badges con iconos SVG)
✓ Botón WhatsApp con mensaje pre-llenado
✓ Microcopy en CTA principal
✓ Sección de servicios relacionados
✓ Layout responsive 2 columnas

SCRIPTS SQL APLICADOS:

-- 1. Crear tabla servicio_imagenes
CREATE TABLE IF NOT EXISTS `servicio_imagenes` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `servicio_id` INT(11) NOT NULL,
  `url` VARCHAR(500) NOT NULL COMMENT 'Image URL or path',
  `alt_text` VARCHAR(255) NULL COMMENT 'Alt text for SEO and accessibility',
  `orden` INT DEFAULT 0 COMMENT 'Display order (0 = first)',
  `es_principal` TINYINT(1) DEFAULT 0 COMMENT 'Is this the main/featured image?',
  `activo` TINYINT(1) DEFAULT 1 COMMENT 'Soft delete flag',
  `fecha_creacion` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `fecha_actualizacion` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `servicio_id` (`servicio_id`),
  KEY `idx_servicio_activo` (`servicio_id`, `activo`),
  KEY `idx_servicio_orden` (`servicio_id`, `orden`),
  KEY `idx_principal` (`servicio_id`, `es_principal`),
  CONSTRAINT `servicio_imagenes_ibfk_1` FOREIGN KEY (`servicio_id`) REFERENCES `servicios` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='Gallery images for services';

-- 2. Actualizar tipo de servicios
ALTER TABLE `servicios` 
MODIFY COLUMN `tipo` ENUM('basico','premium') DEFAULT 'basico';

UPDATE `servicios` 
SET `tipo` = 'premium' 
WHERE `tipo` = 'avanzado';

-- 3. Migrar imagen_url a servicio_imagenes
INSERT INTO servicio_imagenes (servicio_id, url, alt_text, orden, es_principal, activo)
SELECT 
    id, 
    imagen_url,
    CONCAT('Imagen principal de ', nombre) as alt_text,
    0 as orden,
    1 as es_principal,
    1 as activo
FROM servicios 
WHERE imagen_url IS NOT NULL 
  AND imagen_url != ''
  AND NOT EXISTS (
      SELECT 1 FROM servicio_imagenes WHERE servicio_id = servicios.id AND es_principal = 1
  );

-- 4. Reset completo con servicios de ejemplo
DELETE FROM servicios;
ALTER TABLE servicios AUTO_INCREMENT = 1;
ALTER TABLE servicio_imagenes AUTO_INCREMENT = 1;

INSERT INTO servicios (nombre, tipo, precio, descripcion, imagen_url, activo) VALUES
('Reparación y Mantenimiento de Laptops', 'premium', 899.00, 
'Servicio completo de reparación y mantenimiento para tu laptop. Incluye diagnóstico, limpieza profunda, reemplazo de componentes, actualización de software y garantía de 3 meses.',
'https://images.unsplash.com/photo-1588872657578-7efd1f1555ed?w=800&q=80', 1),

('Ensamblaje de PC Gaming/Profesional', 'premium', 1499.00,
'Armado y configuración de PC personalizado. Incluye selección de componentes, ensamblaje profesional, instalación de SO, drivers, pruebas de rendimiento y garantía de 6 meses.',
'https://images.unsplash.com/photo-1591799264318-7e6ef8ddb7ea?w=800&q=80', 1),

('Instalación y Configuración de Software', 'basico', 299.00,
'Instalación profesional de programas: sistemas operativos, suite de oficina, antivirus, software de diseño. Incluye configuración óptima, activación legal y capacitación básica.',
'https://images.unsplash.com/photo-1629654297299-c8506221ca97?w=800&q=80', 1),

('Mantenimiento Preventivo de Equipos', 'basico', 449.00,
'Limpieza profunda, renovación de pasta térmica, optimización de sistema, actualización de drivers, verificación de disco duro/SSD y reporte técnico detallado.',
'https://images.unsplash.com/photo-1587825140708-dfaf72ae4b04?w=800&q=80', 1),

('Recuperación de Datos y Archivos', 'premium', 1299.00,
'Recuperación profesional de información perdida de discos duros, SSD, USB, tarjetas SD. Evaluación gratuita, sin datos recuperados no hay cargo.',
'https://images.unsplash.com/photo-1633265486064-086b219458ec?w=800&q=80', 1),

('Plan de Soporte Técnico Mensual', 'premium', 599.00,
'Soporte técnico 24/7 vía WhatsApp/email, 2 visitas presenciales al mes, mantenimiento remoto semanal, actualizaciones, asesoría y respaldo en la nube.',
'https://images.unsplash.com/photo-1516321318423-f06f85e504b3?w=800&q=80', 1);

-- Insertar imágenes de galería (ejemplo para ID 1)
INSERT INTO servicio_imagenes (servicio_id, url, alt_text, orden, es_principal) VALUES
(1, 'https://images.unsplash.com/photo-1588872657578-7efd1f1555ed?w=800&q=80', 'Laptop siendo reparada por técnico profesional', 0, 1),
(1, 'https://images.unsplash.com/photo-1593642532842-98d0fd5ebc1a?w=800&q=80', 'Herramientas de reparación profesionales', 1, 0),
(1, 'https://images.unsplash.com/photo-1625948515291-69613efd103f?w=800&q=80', 'Mantenimiento interno de laptop', 2, 0),
(1, 'https://images.unsplash.com/photo-1591405351990-4726e331f141?w=800&q=80', 'Diagnóstico de componentes electrónicos', 3, 0);

=================================================================
ARCHIVOS MODIFICADOS POR FECHA
=================================================================

NOVIEMBRE 20, 2025:
Backend:
  - backend/models/Servicio.js (JOIN con servicio_imagenes)

Frontend:
  - fronted/src/pages/ServicioDetail.jsx (galería + mejoras UX)
  - fronted/src/styles/ServicioDetail.css (diseño moderno completo)

Database:
  - Documentación/nextlevel.sql (estructura actualizada)

=================================================================
CONSULTAS ÚTILES DE VERIFICACIÓN
=================================================================

-- Ver servicios con conteo de imágenes
SELECT 
    s.id, s.nombre, s.tipo, CONCAT('$', s.precio) as precio,
    COUNT(si.id) as total_imagenes
FROM servicios s
LEFT JOIN servicio_imagenes si ON s.id = si.servicio_id
GROUP BY s.id
ORDER BY s.id;

-- Ver todas las imágenes ordenadas
SELECT 
    s.nombre as servicio, si.alt_text, si.es_principal, si.orden
FROM servicio_imagenes si
JOIN servicios s ON si.servicio_id = s.id
ORDER BY si.servicio_id, si.orden;

-- Verificar estructura de servicio_imagenes
DESCRIBE servicio_imagenes;

-- Verificar estructura de servicios
DESCRIBE servicios;

=================================================================
FIN DE DOCUMENTACIÓN
=================================================================