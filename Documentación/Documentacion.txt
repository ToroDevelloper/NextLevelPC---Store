=================================================================
NEXTLEVEL PC - DOCUMENTACIÓN DE CAMBIOS Y MEJORAS
=================================================================

PENDIENTES:
- Login: mostrar nombre del usuario al logiarse y apartado de perfil
- Productos: organización más dinámica con carruseles horizontales
- Footer: iconos reales de redes sociales (Facebook, Instagram)
- Admin: interfaz para subir productos desde el dashboard

=================================================================
IMPLEMENTACIONES COMPLETADAS
=================================================================

-------------------------------------------------------------------
NOVIEMBRE 14-15, 2025 - SISTEMA BASE
-------------------------------------------------------------------

✓ Detalle de Servicios con página individual
✓ Campo imagen_url en tabla servicios
✓ Carrito de compras con persistencia (localStorage)
✓ Agendamiento de citas para servicios
✓ Sistema de roles (cliente, empleado, admin)
✓ Perfil básico en SPA
✓ Tabla refresh_tokens para autenticación

SCRIPTS SQL APLICADOS:

-- Agregar imagen_url a servicios (si no existe)
ALTER TABLE `servicios`
  ADD COLUMN `imagen_url` varchar(255) DEFAULT NULL AFTER `descripcion`;

-- Tabla citas_servicios
CREATE TABLE IF NOT EXISTS `citas_servicios` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `servicio_id` INT(11) NOT NULL,
  `nombre_cliente` VARCHAR(255) NOT NULL,
  `email_cliente` VARCHAR(255) NOT NULL,
  `telefono_cliente` VARCHAR(50) NOT NULL,
  `direccion_cliente` TEXT NOT NULL,
  `fecha_cita` DATETIME NOT NULL,
  `descripcion_problema` TEXT DEFAULT NULL,
  `estado` ENUM('pendiente', 'confirmada', 'cancelada', 'completada') NOT NULL DEFAULT 'pendiente',
  `created_at` TIMESTAMP NULL DEFAULT current_timestamp(),
  PRIMARY KEY (`id`),
  KEY `servicio_id` (`servicio_id`),
  CONSTRAINT `citas_servicios_ibfk_1` FOREIGN KEY (`servicio_id`) REFERENCES `servicios` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- Tabla refresh_tokens
CREATE TABLE `refresh_tokens` (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    token VARCHAR(512) NOT NULL UNIQUE,
    expires_at DATETIME NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES usuarios(id) ON DELETE CASCADE,
    INDEX idx_user_id (user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- Descripción detallada en productos
ALTER TABLE `productos`
  ADD COLUMN `descripcion_corta` VARCHAR(300) NULL AFTER `nombre`,
  ADD COLUMN `descripcion_detallada` TEXT NULL AFTER `descripcion_corta`,
  ADD COLUMN `especificaciones` TEXT NULL AFTER `descripcion_detallada`;

-------------------------------------------------------------------
NOVIEMBRE 16, 2025 - MEJORAS PRODUCTOS Y FILTROS
-------------------------------------------------------------------

✓ Filtrado por categorías en productos
✓ Estado visual de productos (activo/inactivo)
✓ Mejoras en normalización de imágenes
✓ Optimización de rendimiento con memoización
✓ Custom hooks para separación de responsabilidades

SCRIPTS SQL APLICADOS:

-- Modificar columna activo a estado
ALTER TABLE productos DROP COLUMN activo;
ALTER TABLE productos ADD COLUMN estado TINYINT(1) NOT NULL DEFAULT 1;

-------------------------------------------------------------------
NOVIEMBRE 20, 2025 - GALERÍA DE IMÁGENES Y UX SERVICIOS
-------------------------------------------------------------------

✓ Sistema de galería con tabla relacional (servicio_imagenes)
✓ Redesign página detalle servicios (inspirado en Mercado Libre)
✓ Breadcrumbs de navegación
✓ Trust Badges (4 badges con iconos SVG)
✓ Botón WhatsApp con mensaje pre-llenado
✓ Microcopy en CTA principal
✓ Sección de servicios relacionados
✓ Layout responsive 2 columnas

SCRIPTS SQL APLICADOS:

-- 1. Crear tabla servicio_imagenes
CREATE TABLE IF NOT EXISTS `servicio_imagenes` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `servicio_id` INT(11) NOT NULL,
  `url` VARCHAR(500) NOT NULL COMMENT 'Image URL or path',
  `alt_text` VARCHAR(255) NULL COMMENT 'Alt text for SEO and accessibility',
  `orden` INT DEFAULT 0 COMMENT 'Display order (0 = first)',
  `es_principal` TINYINT(1) DEFAULT 0 COMMENT 'Is this the main/featured image?',
  `activo` TINYINT(1) DEFAULT 1 COMMENT 'Soft delete flag',
  `fecha_creacion` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `fecha_actualizacion` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `servicio_id` (`servicio_id`),
  KEY `idx_servicio_activo` (`servicio_id`, `activo`),
  KEY `idx_servicio_orden` (`servicio_id`, `orden`),
  KEY `idx_principal` (`servicio_id`, `es_principal`),
  CONSTRAINT `servicio_imagenes_ibfk_1` FOREIGN KEY (`servicio_id`) REFERENCES `servicios` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='Gallery images for services';

-- 2. Migrar imagen_url a servicio_imagenes
INSERT INTO servicio_imagenes (servicio_id, url, alt_text, orden, es_principal, activo)
SELECT 
    id, 
    imagen_url,
    CONCAT('Imagen principal de ', nombre) as alt_text,
    0 as orden,
    1 as es_principal,
    1 as activo
FROM servicios 
WHERE imagen_url IS NOT NULL 
  AND imagen_url != ''
  AND NOT EXISTS (
      SELECT 1 FROM servicio_imagenes WHERE servicio_id = servicios.id AND es_principal = 1
  );

-- 3. Reset completo con 12 servicios (6 básicos, 6 avanzados)
DELETE FROM servicios;
ALTER TABLE servicios AUTO_INCREMENT = 1;
ALTER TABLE servicio_imagenes AUTO_INCREMENT = 1;

INSERT INTO servicios (nombre, tipo, precio, descripcion, imagen_url, activo) VALUES
-- BÁSICOS
('Instalación de Windows/Linux', 'basico', 299.00,
'Instalación limpia de sistema operativo Windows o Linux. Incluye drivers básicos, actualizaciones de seguridad, antivirus gratuito y configuración inicial del sistema.',
'https://images.unsplash.com/photo-1629654297299-c8506221ca97?w=800&q=80', 1),

('Limpieza y Mantenimiento Básico', 'basico', 199.00,
'Limpieza física de componentes, eliminación de archivos temporales, optimización de inicio de Windows y verificación de salud de disco duro.',
'https://images.unsplash.com/photo-1587825140708-dfaf72ae4b04?w=800&q=80', 1),

('Instalación de Office y Programas', 'basico', 249.00,
'Instalación de suite Office (Word, Excel, PowerPoint), navegadores, reproductores multimedia, compresores de archivos y programas básicos.',
'https://images.unsplash.com/photo-1551808525-51a94da548ce?w=800&q=80', 1),

('Diagnóstico de Problemas', 'basico', 149.00,
'Diagnóstico completo de hardware y software para identificar fallas. Incluye reporte detallado de problemas encontrados y cotización de reparación.',
'https://images.unsplash.com/photo-1591405351990-4726e331f141?w=800&q=80', 1),

('Configuración de Router WiFi', 'basico', 199.00,
'Configuración de router inalámbrico, cambio de contraseñas, optimización de canales WiFi, configuración de seguridad WPA3 y pruebas de velocidad.',
'https://images.unsplash.com/photo-1606904825846-647eb07f5be2?w=800&q=80', 1),

('Respaldo de Datos (Backup)', 'basico', 299.00,
'Respaldo completo de documentos, fotos, videos y archivos importantes a disco externo o nube. Incluye verificación de integridad de datos.',
'https://images.unsplash.com/photo-1544654803-b69140b285a1?w=800&q=80', 1),

-- AVANZADOS
('Ensamblaje de PC Gaming/Workstation', 'avanzado', 1499.00,
'Armado profesional de PC gaming o estación de trabajo. Incluye: selección optimizada de componentes, ensamblaje con cable management, instalación de SO y drivers, overclock seguro y garantía de 6 meses.',
'https://images.unsplash.com/photo-1591799264318-7e6ef8ddb7ea?w=800&q=80', 1),

('Reparación Avanzada de Laptops', 'avanzado', 899.00,
'Reparación de nivel experto: reballing de GPU/CPU, cambio de bisagras, reemplazo de pantalla LED/OLED, upgrading a SSD NVMe, expansión de RAM y renovación de pasta térmica.',
'https://images.unsplash.com/photo-1588872657578-7efd1f1555ed?w=800&q=80', 1),

('Recuperación de Datos Profesional', 'avanzado', 1299.00,
'Recuperación avanzada de datos de discos duros dañados, SSD, RAID, tarjetas SD corruptas. Utilizamos software forense. Evaluación gratuita, pago solo si recuperamos tus datos.',
'https://images.unsplash.com/photo-1633265486064-086b219458ec?w=800&q=80', 1),

('Instalación de Red Empresarial', 'avanzado', 2499.00,
'Diseño e implementación de red empresarial completa. Incluye: cableado estructurado Cat6/Cat7, switches administrables, puntos de acceso WiFi 6, servidor de dominio y firewall.',
'https://images.unsplash.com/photo-1558494949-ef010cbdcc31?w=800&q=80', 1),

('Configuración de Servidor (Windows Server/Linux)', 'avanzado', 1899.00,
'Instalación y configuración completa de servidor empresarial: Active Directory, DNS, DHCP, File Server, controlador de dominio, políticas de grupo y respaldos automáticos.',
'https://images.unsplash.com/photo-1544197150-b99a580bb7a8?w=800&q=80', 1),

('Plan de Soporte Técnico Empresarial', 'avanzado', 999.00,
'Soporte técnico integral mensual: atención 24/7 vía WhatsApp/email/llamada, 3 visitas presenciales incluidas, mantenimiento preventivo mensual y monitoreo remoto.',
'https://images.unsplash.com/photo-1516321318423-f06f85e504b3?w=800&q=80', 1);

-- 4. Insertar galerías (ejemplo servicio ID 1)
INSERT INTO servicio_imagenes (servicio_id, url, alt_text, orden, es_principal) VALUES
(1, 'https://images.unsplash.com/photo-1629654297299-c8506221ca97?w=800&q=80', 'Instalación de sistema operativo', 0, 1),
(1, 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800&q=80', 'Configuración de Windows', 1, 0),
(1, 'https://images.unsplash.com/photo-1551808525-51a94da548ce?w=800&q=80', 'Escritorio configurado', 2, 0),
(1, 'https://images.unsplash.com/photo-1538688423619-a81d3f23454b?w=800&q=80', 'Actualizaciones del sistema', 3, 0);

-- (Repetir para los 11 servicios restantes - Ver script completo: reset_servicios_basico_avanzado.sql)

=================================================================
ARCHIVOS MODIFICADOS POR FECHA
=================================================================

NOVIEMBRE 20, 2025:
Backend:
  - backend/models/Servicio.js (JOIN con servicio_imagenes)

Frontend:
  - fronted/src/pages/ServicioDetail.jsx (galería + mejoras UX)
  - fronted/src/styles/ServicioDetail.css (diseño moderno completo)

Database:
  - Documentación/nextlevel.sql (estructura actualizada)

=================================================================
CONSULTAS ÚTILES DE VERIFICACIÓN
=================================================================

-- Ver servicios con conteo de imágenes
SELECT 
    s.id, s.nombre, s.tipo, CONCAT('$', s.precio) as precio,
    COUNT(si.id) as total_imagenes
FROM servicios s
LEFT JOIN servicio_imagenes si ON s.id = si.servicio_id
GROUP BY s.id
ORDER BY s.id;

-- Ver todas las imágenes ordenadas
SELECT 
    s.nombre as servicio, si.alt_text, si.es_principal, si.orden
FROM servicio_imagenes si
JOIN servicios s ON si.servicio_id = s.id
ORDER BY si.servicio_id, si.orden;

-- Resumen por tipo
SELECT 
    tipo,
    COUNT(*) as total,
    CONCAT('$', MIN(precio)) as min,
    CONCAT('$', MAX(precio)) as max
FROM servicios
WHERE activo = 1
GROUP BY tipo;

-- Verificar estructura de servicio_imagenes
DESCRIBE servicio_imagenes;

-- Verificar estructura de servicios
DESCRIBE servicios;

=================================================================
FIN DE DOCUMENTACIÓN
=================================================================