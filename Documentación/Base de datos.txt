-- BASE DE DATOS SIMPLIFICADA - TABLAS ESENCIALES

CREATE DATABASE IF NOT EXISTS sistema_gestion
  DEFAULT CHARACTER SET = utf8mb4
  DEFAULT COLLATE = utf8mb4_unicode_ci;
USE sistema_gestion;

-- ROLES
CREATE TABLE roles (
  id INT AUTO_INCREMENT PRIMARY KEY,
  nombre VARCHAR(50) NOT NULL UNIQUE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

INSERT IGNORE INTO roles (nombre) VALUES
  ('Administrador'),
  ('Empleado'),
  ('Cliente');

-- USUARIOS
CREATE TABLE usuarios (
  id INT AUTO_INCREMENT PRIMARY KEY,
  nombre VARCHAR(100) NOT NULL,
  apellido VARCHAR(100) NOT NULL,
  correo VARCHAR(150) NOT NULL UNIQUE,
  hash_password VARCHAR(255) NOT NULL,
  rol_id INT NOT NULL,
  estado ENUM('Activo','Inactivo') DEFAULT 'Activo',
  FOREIGN KEY (rol_id) REFERENCES roles(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- CATEGORIAS
CREATE TABLE categorias (
  id INT AUTO_INCREMENT PRIMARY KEY,
  nombre VARCHAR(100) NOT NULL UNIQUE,
  tipo ENUM('Producto','Servicio') DEFAULT 'Producto'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

INSERT IGNORE INTO categorias (nombre, tipo) VALUES
  ('Periferico', 'Producto'),
  ('Repuesto', 'Producto'),
  ('Servicio TÃ©cnico', 'Servicio');

-- PRODUCTOS
CREATE TABLE productos (
  id INT AUTO_INCREMENT PRIMARY KEY,
  nombre VARCHAR(200) NOT NULL,
  categoria_id INT NOT NULL,
  precio_actual DECIMAL(12,2) NOT NULL,
  stock INT DEFAULT 0,
  activo TINYINT(1) DEFAULT 1,
  FOREIGN KEY (categoria_id) REFERENCES categorias(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- SERVICIOS
CREATE TABLE servicios (
  id INT AUTO_INCREMENT PRIMARY KEY,
  nombre VARCHAR(200) NOT NULL,
  categoria_id INT NOT NULL,
  precio DECIMAL(12,2) NOT NULL,
  FOREIGN KEY (categoria_id) REFERENCES categorias(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- ORDENES
CREATE TABLE ordenes (
  id INT AUTO_INCREMENT PRIMARY KEY,
  cliente_id INT NOT NULL,
  tipo ENUM('Venta','Servicio') NOT NULL,
  numero_orden VARCHAR(50) UNIQUE,
  total DECIMAL(12,2) DEFAULT 0.00,
  estado_orden ENUM('Pendiente','Confirmada','Completada','Cancelada') DEFAULT 'Pendiente',
  estado_pago ENUM('Pendiente','Pagado','Fallido') DEFAULT 'Pendiente',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (cliente_id) REFERENCES usuarios(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- ITEMS DE ORDEN
CREATE TABLE orden_items (
  id INT AUTO_INCREMENT PRIMARY KEY,
  orden_id INT NOT NULL,
  tipo ENUM('Producto','Servicio') NOT NULL,
  producto_id INT NULL,
  servicio_id INT NULL,
  descripcion VARCHAR(255) NOT NULL,
  cantidad INT DEFAULT 1,
  precio_unitario DECIMAL(12,2) NOT NULL,
  subtotal DECIMAL(12,2) NOT NULL,
  FOREIGN KEY (orden_id) REFERENCES ordenes(id) ON DELETE CASCADE,
  FOREIGN KEY (producto_id) REFERENCES productos(id),
  FOREIGN KEY (servicio_id) REFERENCES servicios(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;